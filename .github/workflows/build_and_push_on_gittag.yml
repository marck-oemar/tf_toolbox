name: Build and Push on git tag

on:
  workflow_dispatch:
  # push:
  #   tags:
  #     - "v*.*.*"

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
      - 
        name: Checkout
        uses: actions/checkout@v2

      # The :10 strips the first ten characters from the environment variable GITHUB_REF which contains refs/tags/v1.2.3 so it yields v1.2.3
      - name: Get Tag
        run: |
          echo ::set-env name=RELEASE_VERSION::$(echo ${GITHUB_REF:10})
          #echo "git_tag=${RELEASE_VERSION}" >> $GITHUB_ENV
          echo ${RELEASE_VERSION}
      - name: show env
        run: echo ${RELEASE_VERSION}


      # -       
      #   name: Set up Docker Buildx
      #   id: buildx
      #   uses: docker/setup-buildx-action@v1
      # -     
      #   name: Cache Docker layers
      #   uses: actions/cache@v2
      #   with:
      #     path: /tmp/.buildx-cache
      #     key: ${{ runner.os }}-buildx-${{ github.sha }}
      #     restore-keys: |
      #       ${{ runner.os }}-buildx-
      # - 
      #   uses: docker/login-action@v1 
      #   with:
      #     username: ${{ secrets.DOCKERHUB_USERNAME }}
      #     password: ${{ secrets.DOCKERHUB_TOKEN }}
      # -
      #   name: Build and push
      #   env:
      #     FULL_TAG: "renatomefi/docker-testinfra:2"

      #   id: docker_build
      #   uses: docker/build-push-action@v2
      #   with:
      #     context: ./ 
      #     file: ./Dockerfile
      #     builder: ${{ steps.buildx.outputs.name }}
      #     push: true
      #     tags: elmoenco/tf_toolbox:${{ RELEASE_VERSION }}
      #     cache-from: type=local,src=/tmp/.buildx-cache
      #     cache-to: type=local,dest=/tmp/.buildx-cache
      # -
      #   name: Image digest
      #   run: echo ${{ steps.docker_build.outputs.digest }}